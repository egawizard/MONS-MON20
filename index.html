<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MON-20 Explorer ($MONS)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.2/web3.min.js"></script>
  <style>
    body { font-family: sans-serif; background:#0b0d14; color:#e9eef5; margin:0; }
    .container { max-width:1100px; margin:auto; padding:20px; }
    h1 { text-align:center; color:#4ecdc4; }
    .stats { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; margin:20px 0; }
    .card { background:#141827; padding:15px; border-radius:12px; text-align:center; }
    .card h2 { margin:0; color:#4ecdc4; }
    .progress { height:12px; background:#262a3a; border-radius:8px; overflow:hidden; margin:20px 0; }
    .bar { height:100%; width:0; background:linear-gradient(90deg,#4ecdc4,#45b7d1); }
    .row { text-align:center; margin:20px 0; }
    button { background:#4ecdc4; border:none; padding:10px 18px; border-radius:8px; font-weight:bold; cursor:pointer; }
    button:disabled { opacity:0.5; }
    .holders { background:#141827; border-radius:12px; padding:15px; margin-top:20px; }
    .holder { display:flex; justify-content:space-between; padding:6px 0; border-bottom:1px solid rgba(255,255,255,0.05); }
    .mono { font-family: monospace; }
    .footer { text-align:center; opacity:.7; margin:30px 0 10px; font-size:14px; }
  </style>
</head>
<body>
<div class="container">
  <h1>MONAD MON-20 • $MONS</h1>
  <div class="stats">
    <div class="card"><h2 id="totalMinted">0</h2><p>Total Minted</p></div>
    <div class="card"><h2 id="remaining">21,000,000</h2><p>Remaining</p></div>
    <div class="card"><h2 id="holders">0</h2><p>Holders</p></div>
    <div class="card"><h2 id="mintCount">0</h2><p>Mint Count</p></div>
  </div>
  <div class="progress"><div class="bar" id="progressFill"></div></div>
  
  <div class="row">
    <button id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
    <span id="addr" class="mono"></span>
    <div id="balance" style="margin-top:10px;color:#9aa3b2;"></div>
  </div>

  <div class="holders">
    <h3>Top Holders</h3>
    <div id="holdersList"><div class="holder"><span>No holders yet</span><span>0 MONS</span></div></div>
  </div>

  <div class="footer">
    Created by <a href="https://x.com/ega_2ez4crypto" target="_blank" style="color:#4ecdc4">@ega_2ez4crypto</a><br>
    Fully on-chain • Powered by Monad Testnet
  </div>
</div>

<script>
const API = "https://mon20-indexer-backend-production.up.railway.app"; // ganti sesuai Railway URL
const MAX_SUPPLY = 21000000;
let web3;
let currentAccount;

// Fetch stats & holders
async function loadData(){
  try {
    const stats = await fetch(API + "/stats").then(r=>r.json());
    const holders = await fetch(API + "/holders").then(r=>r.json());

    document.getElementById("totalMinted").innerText = stats.totalMinted.toLocaleString();
    document.getElementById("remaining").innerText = (MAX_SUPPLY - stats.totalMinted).toLocaleString();
    document.getElementById("holders").innerText = holders.length;
    document.getElementById("mintCount").innerText = stats.mintCount.toLocaleString();

    document.getElementById("progressFill").style.width = Math.min(100,(stats.totalMinted / MAX_SUPPLY) * 100) + "%";

    const list = document.getElementById("holdersList");
    list.innerHTML = "";
    if(holders.length===0){
      list.innerHTML = '<div class="holder"><span>No holders yet</span><span>0 MONS</span></div>';
    } else {
      holders.forEach(h=>{
        list.innerHTML += `<div class="holder"><span>${h.address}</span><span>${h.balance.toLocaleString()} MONS</span></div>`;
      });
    }
  } catch(e){
    console.error("Failed to fetch stats", e);
  }
}

// Connect wallet
async function connectWallet(){
  if(!window.ethereum){ alert("Please install MetaMask!"); return; }
  web3 = new Web3(window.ethereum);
  try {
    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
    currentAccount = accounts[0];
    document.getElementById("connectBtn").innerText = "Wallet Connected";
    document.getElementById("addr").innerText = shortAddr(currentAccount);
    loadBalance();
  } catch(e){ console.error(e); }
}

// Fetch balance from holders API
async function loadBalance(){
  if(!currentAccount) return;
  try {
    const holders = await fetch(API + "/holders").then(r=>r.json());
    const h = holders.find(x=>x.address.toLowerCase()===currentAccount.toLowerCase());
    const bal = h ? h.balance : 0;
    document.getElementById("balance").innerText = "Your Balance: " + bal.toLocaleString() + " MONS";
  } catch(e){ console.error(e); }
}

function shortAddr(a){ return a.slice(0,6)+"…"+a.slice(-4); }

setInterval(loadData, 15000);
loadData();
</script>
</body>
</html>
