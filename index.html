<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MON-20 Explorer & Minter</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.15.0/dist/ethers.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <style>
    body { background: #0f172a; color: #f1f5f9; font-family: 'Inter', sans-serif; }
    .sidebar { background: #1e293b; height: 100vh; padding: 1.5rem; }
    .card { background: #1e293b; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0,0,0,.4); transition: transform 0.3s, box-shadow 0.3s; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,.6); }
    .btn { background: linear-gradient(90deg, #6366f1, #06b6d4); padding: 0.7rem 1.5rem; border-radius: 0.7rem; font-weight: bold; color: white; cursor: pointer; transition: 0.3s; }
    .btn:hover { opacity: 0.85; transform: scale(1.05); }
    #holdersTable tr:hover { background: rgba(255,255,255,0.05); transition: 0.2s; }
    .progress-bar { transition: width 1.2s ease-in-out; }
  </style>
</head>
<body class="flex">

  <!-- Sidebar -->
  <div class="sidebar w-64 flex flex-col text-lg">
    <h1 class="text-2xl font-bold mb-8 text-center animate__animated animate__fadeInDown">ğŸš€ MON-20</h1>
    <nav class="flex flex-col space-y-4">
      <a href="#wallet" class="hover:text-cyan-400">ğŸ’³ Wallet</a>
      <a href="#stats" class="hover:text-cyan-400">ğŸ“Š Stats</a>
      <a href="#mint" class="hover:text-cyan-400">ğŸª™ Mint</a>
      <a href="#holders" class="hover:text-cyan-400">ğŸ† Holders</a>
    </nav>
    <div class="mt-auto text-sm text-gray-400 text-center">
      Built fully on-chain <br>
      Credit: <a href="https://x.com/ega_2ez4crypto" target="_blank" class="text-cyan-400 hover:underline">@ega_2ez4crypto</a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 p-10 space-y-10 animate__animated animate__fadeIn">

    <!-- Full On-Chain Banner -->
    <div class="card text-center animate__animated animate__fadeInUp">
      <p class="text-lg font-semibold">ğŸ“œ This protocol is <span class="text-cyan-400">FULLY ON-CHAIN</span> â€” no centralized storage</p>
    </div>

    <!-- Wallet -->
    <div id="wallet" class="card w-full animate__animated animate__fadeInUp">
      <h2 class="text-xl font-semibold mb-3">Wallet</h2>
      <button id="connectBtn" class="btn mb-3">Connect Wallet</button>
      <p id="walletAddr" class="break-all text-sm text-gray-300"></p>
      <p id="walletBal" class="text-lg font-bold"></p>
    </div>

    <!-- Stats -->
    <div id="stats" class="card w-full animate__animated animate__fadeInUp">
      <h2 class="text-2xl font-semibold mb-4">ğŸ“Š Token Stats</h2>
      <div class="grid grid-cols-4 gap-6 mb-4">
        <div class="p-4 bg-gray-800 rounded-lg text-center">
          <p class="text-gray-400">Total Minted</p>
          <p id="totalMinted" class="text-2xl font-bold">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg text-center">
          <p class="text-gray-400">Mint Count</p>
          <p id="mintCount" class="text-2xl font-bold">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg text-center">
          <p class="text-gray-400">Total Holders</p>
          <p id="totalHolders" class="text-2xl font-bold">0</p>
        </div>
        <div class="p-4 bg-gray-800 rounded-lg text-center">
          <p class="text-gray-400">Last Block</p>
          <p id="lastBlock" class="text-2xl font-bold">0</p>
        </div>
      </div>
      <div class="w-full bg-gray-700 h-4 rounded mt-3">
        <div id="mintProgress" class="progress-bar bg-gradient-to-r from-indigo-500 to-cyan-400 h-4 rounded" style="width:0%"></div>
      </div>
    </div>

    <!-- Mint -->
    <div id="mint" class="card w-full text-center animate__animated animate__fadeInUp">
      <h2 class="text-xl font-semibold mb-3">Mint MONS</h2>
      <button id="mintBtn" class="btn">Mint 1000 MONS</button>
      <p id="mintStatus" class="mt-3 text-sm text-gray-300"></p>
    </div>

    <!-- Holders -->
    <div id="holders" class="card w-full animate__animated animate__fadeInUp">
      <h2 class="text-2xl font-semibold mb-4">ğŸ† Top Holders</h2>
      <div class="overflow-y-auto max-h-80">
        <table class="w-full text-left">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="py-2">Address</th>
              <th class="py-2">Balance</th>
            </tr>
          </thead>
          <tbody id="holdersTable"></tbody>
        </table>
      </div>
    </div>

  </div>

<script>
const API = "https://mon20-indexer-backend-production.up.railway.app"; 
let provider, signer, userAddr;

// -------- Wallet --------
async function connectWallet() {
  if (!window.ethereum) { alert("Install MetaMask!"); return; }
  provider = new ethers.BrowserProvider(window.ethereum);
  signer = await provider.getSigner();
  userAddr = await signer.getAddress();
  document.getElementById("walletAddr").innerText = userAddr;
  updateBalance();
}
async function updateBalance() {
  if (!provider || !userAddr) return;
  const bal = await provider.getBalance(userAddr);
  document.getElementById("walletBal").innerText =
    "Balance: " + ethers.formatEther(bal) + " MON";
}

// -------- API Fetch --------
async function fetchStats() {
  try {
    const res = await fetch(API + "/stats");
    const s = await res.json();
    document.getElementById("totalMinted").innerText = s.totalMinted;
    document.getElementById("mintCount").innerText  = s.mintCount;
    document.getElementById("lastBlock").innerText  = s.lastBlock;
    document.getElementById("mintProgress").style.width =
      Math.min((s.totalMinted/21000000)*100,100)+"%";
  } catch(e){ console.log("stats err", e); }
}
async function fetchHolders() {
  try {
    const res = await fetch(API + "/holders");
    const h = await res.json();
    const tb = document.getElementById("holdersTable");
    tb.innerHTML = "";
    h.forEach(r => {
      tb.innerHTML += `<tr class="border-b border-gray-700 hover:bg-gray-800">
        <td class="py-1">${r.address}</td>
        <td class="py-1">${r.balance}</td>
      </tr>`;
    });
    document.getElementById("totalHolders").innerText = h.length;
  } catch(e){ console.log("holders err", e); }
}

// -------- Mint --------
async function mint() {
  if (!signer) return alert("Connect wallet dulu");
  try {
    const tx = {
      to: userAddr,
      value: 0,
      data: ethers.hexlify(ethers.toUtf8Bytes(JSON.stringify({
        p: "MON-20",
        op: "mint",
        tick: "MONS",
        amt: "1000"
      })))
    };
    const sent = await signer.sendTransaction(tx);
    document.getElementById("mintStatus").innerText = "â³ Tx sent: " + sent.hash;
    await sent.wait();
    document.getElementById("mintStatus").innerText = "âœ… Mint success!";
    fetchStats(); fetchHolders();
  } catch(e) {
    console.log(e);
    document.getElementById("mintStatus").innerText = "âŒ " + e.message;
  }
}

// -------- Auto Refresh --------
setInterval(()=>{ fetchStats(); fetchHolders(); if(userAddr) updateBalance(); }, 8000);

// -------- Bind Buttons --------
document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("mintBtn").onclick = mint;

// Init
fetchStats(); fetchHolders();
</script>
</body>
</html>
