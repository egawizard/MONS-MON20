<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MON-20 Explorer & Minter</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.10.0/web3.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans">

  <div class="container mx-auto px-4 py-6">
    <!-- Title -->
    <h1 class="text-3xl font-bold text-center text-cyan-400 mb-2">MONAD MON-20 Dashboard</h1>
    <p class="text-center text-gray-400 mb-6">Realtime Indexing ‚Ä¢ Mint & Track $MONS</p>

    <!-- Stats Cards -->
    <div id="stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"></div>

    <!-- Progress Bar -->
    <div class="w-full bg-gray-700 rounded-full h-4 mb-6">
      <div id="progressFill" class="bg-gradient-to-r from-cyan-400 to-blue-500 h-4 rounded-full w-0 transition-all"></div>
    </div>

    <!-- Indexer status -->
    <div class="text-center text-sm text-gray-400 mb-6">
      <span id="scanStatus">Indexing: ‚è≥</span> ‚Ä¢ <span id="lastBlock">Last Block: -</span>
    </div>

    <!-- Wallet Row -->
    <div class="flex justify-center gap-3 mb-8">
      <button id="connectBtn" onclick="connectWallet()" class="bg-cyan-500 hover:bg-cyan-600 px-4 py-2 rounded-lg font-bold">Connect Wallet</button>
      <button id="mintBtn" onclick="mintToken()" disabled class="bg-emerald-500 hover:bg-emerald-600 px-4 py-2 rounded-lg font-bold">Mint 1000 MONS</button>
    </div>

    <!-- Balances -->
    <div id="balances" class="text-center mb-8 hidden">
      <p class="text-lg">Wallet: <span id="walletAddr" class="font-mono"></span></p>
      <p class="text-gray-300">Balance MON: <span id="monBalance">0</span></p>
      <p class="text-gray-300">Balance MONS: <span id="monsBalance">0</span></p>
    </div>

    <!-- Top Holders -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
      <h2 class="text-xl font-bold mb-4">üèÜ Top Holders</h2>
      <div id="holdersList" class="space-y-2 font-mono text-sm text-gray-300">
        <p>No holders yet...</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="text-center text-gray-500 text-xs mt-10">
      Built by <a href="https://x.com/ega_2ez4crypto" target="_blank" class="text-cyan-400">@ega_2ez4crypto</a> ‚Ä¢ Powered by Monad Testnet
    </div>
  </div>

<script>
/* ==== CONFIG ==== */
const API_BASE = "https://mon20-indexer-backend-production.up.railway.app"; // ganti sesuai Railway kamu
const TICK = "MONS";
const MINT_LIMIT = 1000;
const MAX_SUPPLY = 21_000_000;
let currentAccount = null;
let web3;

/* ==== Fetch Stats & Holders ==== */
async function loadStats(){
  try{
    const stats = await (await fetch(API_BASE+"/stats")).json();
    const holders = await (await fetch(API_BASE+"/holders")).json();

    // Render stats cards
    document.getElementById("stats").innerHTML = `
      <div class="bg-gray-800 p-4 rounded-xl text-center">
        <p class="text-2xl font-bold text-cyan-400">${stats.totalMinted.toLocaleString()}</p>
        <p class="text-gray-400">Total Minted</p>
      </div>
      <div class="bg-gray-800 p-4 rounded-xl text-center">
        <p class="text-2xl font-bold text-cyan-400">${(MAX_SUPPLY - stats.totalMinted).toLocaleString()}</p>
        <p class="text-gray-400">Remaining</p>
      </div>
      <div class="bg-gray-800 p-4 rounded-xl text-center">
        <p class="text-2xl font-bold text-cyan-400">${holders.length.toLocaleString()}</p>
        <p class="text-gray-400">Holders</p>
      </div>
      <div class="bg-gray-800 p-4 rounded-xl text-center">
        <p class="text-2xl font-bold text-cyan-400">${stats.mintCount.toLocaleString()}</p>
        <p class="text-gray-400">Mint Count</p>
      </div>
    `;

    // Progress bar
    document.getElementById("progressFill").style.width = Math.min(100, (stats.totalMinted / MAX_SUPPLY)*100) + "%";
    document.getElementById("scanStatus").innerText = "Indexing: ‚úÖ";
    document.getElementById("lastBlock").innerText = "Last Block: " + stats.lastBlock.toLocaleString();

    // Top holders
    const list = document.getElementById("holdersList");
    list.innerHTML = "";
    holders.slice(0,15).forEach(h=>{
      list.innerHTML += `<div class="flex justify-between"><span>${h.address.slice(0,6)}...${h.address.slice(-4)}</span><span>${h.balance.toLocaleString()} MONS</span></div>`;
    });
  }catch(e){
    console.error(e);
    document.getElementById("scanStatus").innerText = "Indexing: ‚ùå Failed to fetch";
  }
}
setInterval(loadStats, 10_000);
loadStats();

/* ==== Wallet ==== */
async function connectWallet(){
  if(!window.ethereum){ alert("Please install MetaMask!"); return; }
  try{
    const accs = await window.ethereum.request({method:"eth_requestAccounts"});
    currentAccount = accs[0];
    web3 = new Web3(window.ethereum);

    document.getElementById("connectBtn").innerText = "Wallet Connected";
    document.getElementById("mintBtn").disabled = false;
    document.getElementById("balances").classList.remove("hidden");
    document.getElementById("walletAddr").innerText = currentAccount;

    refreshBalances();
  }catch(e){ console.error(e); }
}

async function refreshBalances(){
  if(!currentAccount || !web3) return;
  try{
    const bal = await web3.eth.getBalance(currentAccount);
    document.getElementById("monBalance").innerText = web3.utils.fromWei(bal,"ether");

    // MONS balance via API
    const holders = await (await fetch(API_BASE+"/holders")).json();
    const h = holders.find(x=>x.address.toLowerCase()===currentAccount.toLowerCase());
    document.getElementById("monsBalance").innerText = h ? h.balance.toLocaleString() : "0";
  }catch(e){ console.error(e); }
}
setInterval(refreshBalances, 15_000);

/* ==== Mint ==== */
async function mintToken(){
  if(!currentAccount){ alert("Connect wallet first"); return; }
  const inscription = { p:"mon-20", op:"mint", tick:TICK, amt:String(MINT_LIMIT) };
  const dataHex = "0x"+Array.from(new TextEncoder().encode(JSON.stringify(inscription))).map(b=>b.toString(16).padStart(2,"0")).join("");
  const tx = { from: currentAccount, to: currentAccount, value:"0x0", data:dataHex };
  try{
    const txHash = await window.ethereum.request({ method:"eth_sendTransaction", params:[tx] });
    alert("Mint submitted: "+txHash);
  }catch(e){ console.error(e); alert("Mint failed: "+(e?.message||e)); }
}
</script>
</body>
</html>
